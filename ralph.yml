# oflike-metal Development Configuration
#
# openFrameworks API ported to macOS Metal
# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé§†å‹•é–‹ç™º: docs/ ãŒè¨­è¨ˆã®çœŸå®Ÿ
#
# Usage:
#   cd /path/to/oflike_metal_skeleton
#   ralph run -c ralph.yml -p "docs/INDEX.md"

event_loop:
  prompt_file: "docs/INDEX.md"
  completion_promise: "LOOP_COMPLETE"
  max_iterations: 1000
  max_runtime_seconds: 28800  # 8 hours
  checkpoint_interval: 5
  starting_event: "build.task"

cli:
  backend: "claude"

core:
  specs_dir: "./docs/"
  guardrails:
    # === ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé§†å‹• ===
    - "docs/INDEX.md ã‚’æœ€åˆã«èª­ã‚€ - å…¨ä½“æ§‹é€ ã‚’æŠŠæ¡"
    - "docs/ARCHITECTURE.md ã®ç¦æ­¢äº‹é …ã¯çµ¶å¯¾ - ä¾‹å¤–ãªã—"
    - "docs/IMPLEMENTATION.md ã§é€²æ—ç¢ºèª - æ¬¡ã®Phaseã‚’ç‰¹å®š"
    - "docs/api/*.md ã«è¨­è¨ˆãŒã‚ã‚‹ - å®Ÿè£…å‰ã«å¿…ãšç¢ºèª"
    - "docs/metal/*.md ã§Metalè©³ç´°ã‚’ç¢ºèª"
    # === çµ¶å¯¾ç¦æ­¢ (ARCHITECTURE.md ã‚ˆã‚Š) ===
    - "âŒ FreeTypeç¦æ­¢ â†’ Core Textä½¿ç”¨"
    - "âŒ stb_imageç¦æ­¢ â†’ ImageIO/MTKTextureLoaderä½¿ç”¨"
    - "âŒ OpenGLç¦æ­¢ â†’ Metalä½¿ç”¨"
    - "âŒ SDL/GLFWç¦æ­¢ â†’ Cocoa/AppKitä½¿ç”¨"
    - "âŒ å¤–éƒ¨SIMDãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¦æ­¢ â†’ Accelerateä½¿ç”¨"
    # === å¿…é ˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ ===
    - "âœ… Metal / MetalKit - GPUæç”»"
    - "âœ… Core Text - ãƒ•ã‚©ãƒ³ãƒˆ"
    - "âœ… ImageIO / MTKTextureLoader - ç”»åƒèª­ã¿è¾¼ã¿"
    - "âœ… Core Graphics - ãƒ‘ã‚¹ã€ãƒ“ãƒƒãƒˆãƒãƒƒãƒ—"
    - "âœ… Cocoa - ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã€ã‚¤ãƒ™ãƒ³ãƒˆ"
    # === openFrameworksäº’æ› ===
    - "oF APIã‚·ã‚°ãƒãƒãƒ£ã‚’ç¶­æŒ - å†…éƒ¨ã¯Metalæœ€é©åŒ–"
    - "GLå®šæ•°ã¯å†…éƒ¨ã§Metalã«å¤‰æ›"

hats:
  builder:
    name: "ğŸ”¨ Builder"
    description: "docs/ã®è¨­è¨ˆã«å¾“ã£ã¦å®Ÿè£…ã€‚IMPLEMENTATION.mdã‚’æ›´æ–°ã€‚"
    triggers: ["build.task"]
    publishes: ["build.done", "build.blocked"]
    default_publishes: "build.done"
    instructions: |
      ## BUILDER PHASE

      ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé§†å‹•ã§å®Ÿè£…ã™ã‚‹ã€‚

      ### âš ï¸ æœ€åˆã«å¿…ãšãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ (æ¯å›å®Ÿè¡Œ)

      **Step 1: ç¦æ­¢äº‹é …ã‚’ç¢ºèª**
      ```bash
      cat docs/ARCHITECTURE.md
      ```
      â†’ FreeType/stb_image/OpenGL ã¯çµ¶å¯¾ç¦æ­¢

      **Step 2: å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèª**
      ```bash
      cat docs/IMPLEMENTATION.md
      ```
      â†’ æ¬¡ã® â¬œ æœªå®Ÿè£… ã‚’ç‰¹å®š

      **Step 3: è©²å½“APIã®è¨­è¨ˆã‚’èª­ã‚€**
      ```bash
      # ä¾‹: 3DåŸºç›¤ã‚’å®Ÿè£…ã™ã‚‹å ´åˆ
      cat docs/api/CORE.md
      ```

      **Step 4: Metalå®Ÿè£…è©³ç´°ã‚’ç¢ºèª (å¿…è¦ã«å¿œã˜ã¦)**
      ```bash
      cat docs/metal/PIPELINE.md
      cat docs/metal/SHADERS.md
      ```

      ### å®Ÿè£…ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
      1. â†‘ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ (ã‚¹ã‚­ãƒƒãƒ—ç¦æ­¢)
      2. **docs/api/*.md ã®è¨­è¨ˆã«å¾“ã£ã¦å®Ÿè£…**
      3. **docs/IMPLEMENTATION.md ã‚’æ›´æ–°** - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ âœ… ã«

      ### ç¾åœ¨ã®å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º (IMPLEMENTATION.md ã‚ˆã‚Š)
      - Phase 1-5: âœ… å®Œäº†
      - **Phase 6: 3DåŸºç›¤** â¬œ æœªç€æ‰‹
        - ofNode, 3Dè¡Œåˆ—ã‚¹ã‚¿ãƒƒã‚¯, ofCamera, ofEasyCam
      - **Phase 7: 3Dãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–** â¬œ æœªç€æ‰‹
        - of3dPrimitive, ofBoxPrimitive, ofSpherePrimitive, etc.
      - **Phase 8: ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°** â¬œ æœªç€æ‰‹
        - ofLight, ofMaterial, Phongã‚·ã‚§ãƒ¼ãƒ€ãƒ¼

      ### APIè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
      | ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
      |---------|------|
      | docs/api/CORE.md | ofNode, ofCamera, ofEasyCam |
      | docs/api/GRAPHICS_3D.md | of3dPrimitive, 3Dæç”»é–¢æ•° |
      | docs/api/MESH.md | ofMesh, ofVboMesh |
      | docs/api/LIGHTING.md | ofLight, ofMaterial |
      | docs/metal/PIPELINE.md | ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ |
      | docs/metal/SHADERS.md | ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼è¨­è¨ˆ |

      ### Before Starting
      1. `ralph tools task list` ã§ open tasks ç¢ºèª
      2. ãªã‘ã‚Œã° IMPLEMENTATION.md ã‹ã‚‰æ¬¡ã®ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ
      3. `ralph tools task add "Phase 6: ofNodeå®Ÿè£…" -p 1`

      ### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
      ```
      src/
      â”œâ”€â”€ core/         # Context, Types
      â”œâ”€â”€ render/       # DrawList, metal/
      â””â”€â”€ oflike/
          â”œâ”€â”€ graphics/ # ofGraphics, ofPath, ofColor, ofTrueTypeFont
          â”œâ”€â”€ image/    # ofTexture, ofPixels
          â”œâ”€â”€ types/    # ofRectangle, ofPolyline
          â””â”€â”€ 3d/       # ofMesh, ofNode, ofCamera (â†æ¬¡ã¯ã“ã“)
      ```

      ### Backpressure
      ```bash
      cd build && cmake .. && make -j8 2>&1 | head -100
      ```

      ### å®Œäº†æ™‚
      1. docs/IMPLEMENTATION.md ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ âœ… ã«æ›´æ–°
      2. `ralph tools task close <id>`
      3. `ralph emit "build.done" "implemented: <APIå>, updated: IMPLEMENTATION.md"`

      ### ãƒ–ãƒ­ãƒƒã‚¯æ™‚
      ```bash
      ralph emit "build.blocked" "tried: <what>, blocked: <why>"
      ```

  confessor:
    name: "ğŸ” Confessor"
    description: "ARCHITECTURE.mdæº–æ‹ ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§ã‚’ç›£æŸ»ã€‚"
    triggers: ["build.done"]
    publishes: ["confession.clean", "confession.issues_found"]
    instructions: |
      ## CONFESSION PHASE

      ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨å®Ÿè£…ã®æ•´åˆæ€§ã‚’ç›£æŸ»ã™ã‚‹ã€‚

      ### âš ï¸ æœ€åˆã«å¿…ãšãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ (æ¯å›å®Ÿè¡Œ)

      **Step 1: ARCHITECTURE.md ã‚’èª­ã‚“ã§ç¦æ­¢äº‹é …ã‚’ç¢ºèª**
      ```bash
      cat docs/ARCHITECTURE.md
      ```

      **Step 2: IMPLEMENTATION.md ã‚’èª­ã‚“ã§æ›´æ–°çŠ¶æ³ã‚’ç¢ºèª**
      ```bash
      cat docs/IMPLEMENTATION.md
      ```

      **Step 3: è©²å½“APIã®è¨­è¨ˆæ›¸ã‚’èª­ã‚€**
      ```bash
      # å®Ÿè£…ã•ã‚ŒãŸAPIã«å¯¾å¿œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚€
      cat docs/api/CORE.md        # ofNode, ofCamera
      cat docs/api/GRAPHICS_3D.md # of3dPrimitive
      cat docs/api/LIGHTING.md    # ofLight, ofMaterial
      ```

      ### ARCHITECTURE.md æº–æ‹ ãƒã‚§ãƒƒã‚¯ (æœ€é‡è¦)

      **å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã«ä»¥ä¸‹ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ grep ã§ç¢ºèª:**
      ```bash
      grep -r "FreeType\|freetype" src/
      grep -r "stb_image\|STB_IMAGE" src/
      grep -r "glBegin\|glEnd\|GL_" src/
      grep -r "SDL_\|GLFW" src/
      ```
      â†’ ãƒ’ãƒƒãƒˆã—ãŸã‚‰å³ `confession.issues_found`

      ### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
      1. **docs/api/*.md ã¨å®Ÿè£…ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹?**
         - é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ãŒè¨­è¨ˆé€šã‚Šã‹
         - è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹å…¨æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹
      2. **docs/IMPLEMENTATION.md ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã‹?**
         - å®Ÿè£…ã—ãŸAPIãŒ âœ… ã«ãªã£ã¦ã„ã‚‹ã‹
      3. **docs/metal/*.md ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã«å¾“ã£ã¦ã„ã‚‹ã‹?**

      ### openFrameworksäº’æ›æ€§ãƒã‚§ãƒƒã‚¯
      1. oF APIã‚·ã‚°ãƒãƒãƒ£ã¨ä¸€è‡´?
      2. ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ç´”ç²‹C++? (ObjCå‹ãªã—)

      ### ConfessionReport
      ```bash
      ralph tools memory add "confession: arch-check=passed|FAILED:<detail>" -t context --tags confession
      ralph tools memory add "confession: doc-sync=Yes|No, missing=<what>" -t context --tags confession
      ```

      ### Publish
      - ARCHITECTUREé•å â†’ å³ `confession.issues_found`
      - ãã®ä»–å•é¡Œã‚ã‚Š OR confidence < 80 â†’ `confession.issues_found`
      - å•é¡Œãªã— AND confidence >= 80 â†’ `confession.clean`

  handler:
    name: "âš–ï¸ Handler"
    description: "æ¬¡ã®Phase/ã‚¿ã‚¹ã‚¯ã‚’æ±ºå®šã€‚IMPLEMENTATION.mdã‚’å‚ç…§ã€‚"
    triggers: ["confession.issues_found", "confession.clean"]
    publishes: ["build.task", "escalate.human"]
    instructions: |
      ## HANDLER PHASE

      ### âš ï¸ æœ€åˆã«å¿…ãš IMPLEMENTATION.md ã‚’èª­ã‚€ (æ¯å›å®Ÿè¡Œ)
      ```bash
      cat docs/IMPLEMENTATION.md
      ```
      â†’ ç¾åœ¨ã®Phaseå®Œäº†çŠ¶æ³ã¨æ¬¡ã®ã‚¿ã‚¹ã‚¯ã‚’ç‰¹å®š

      ### confession.issues_found ã®å ´åˆ
      1. å•é¡Œã‚’æ¤œè¨¼
      2. å•é¡ŒãŒå®Ÿåœ¨:
         - è»½å¾®: `ralph tools task add "Fix: <issue>" -p 1` â†’ `build.task`
         - é‡å¤§ (ARCHITECTUREé•å): `escalate.human`
      3. èª¤æ¤œçŸ¥: `escalate.human`

      ### confession.clean ã®å ´åˆ

      **IMPLEMENTATION.md ã® â¬œ ã‚’è¦‹ã¦æ¬¡ã®ã‚¿ã‚¹ã‚¯ã‚’æ±ºå®š:**

      #### Phase 6: 3DåŸºç›¤
      è¨­è¨ˆ: `cat docs/api/CORE.md`
      1. ofNode - 3Då¤‰æ›ãƒãƒ¼ãƒ‰
      2. 3Dè¡Œåˆ—ã‚¹ã‚¿ãƒƒã‚¯ - View/Projectionç®¡ç†
      3. ofCamera - ã‚«ãƒ¡ãƒ©åŸºåº•ã‚¯ãƒ©ã‚¹
      4. ofEasyCam - ãƒã‚¦ã‚¹æ“ä½œã‚«ãƒ¡ãƒ©

      #### Phase 7: 3Dãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–
      è¨­è¨ˆ: `cat docs/api/GRAPHICS_3D.md`
      1. of3dPrimitive - åŸºåº•ã‚¯ãƒ©ã‚¹
      2. ofBoxPrimitive, ofSpherePrimitive
      3. ofCylinderPrimitive, ofConePrimitive
      4. ofPlanePrimitive, ofIcoSpherePrimitive

      #### Phase 8: ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°
      è¨­è¨ˆ: `cat docs/api/LIGHTING.md`
      Metal: `cat docs/metal/SHADERS.md`
      1. ofLight - ãƒ©ã‚¤ãƒˆ
      2. ofMaterial - ãƒãƒ†ãƒªã‚¢ãƒ«
      3. Phongã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ (Metal)

      ### æ¬¡ã®ã‚¿ã‚¹ã‚¯ä½œæˆ
      ```bash
      # æ¬¡ã® â¬œ æœªå®Ÿè£…APIã‚’ç‰¹å®šã—ã¦ã‚¿ã‚¹ã‚¯ä½œæˆ
      ralph tools task add "Phase N: <APIå>å®Ÿè£… - docs/api/XXX.mdå‚ç…§" -p 1
      ralph emit "build.task" "next: <APIå>"
      ```

      ### é€²æ—è¨˜éŒ²
      ```bash
      ralph tools memory add "completed: <APIå>, next: <æ¬¡ã®API>" -t pattern --tags progress
      ```

      ### LOOP_COMPLETE æ¡ä»¶
      - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ "stop" ã¾ãŸã¯ "done" ã¨è¨€ã£ãŸå ´åˆ
      - Phase 8 ã¾ã§å…¨ã¦ âœ… å®Œäº†ã—ãŸå ´åˆ

# Task tracking
tasks:
  enabled: true

# Memory - ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã§å­¦ç¿’ã‚’ä¿æŒ
memories:
  enabled: true
  inject: auto
  budget: 3000
  filter:
    types: []
    tags: []
    recent: 0
