# oflike-metal Development Configuration
#
# openFrameworks API ported to macOS Metal
# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé§†å‹•é–‹ç™º: docs/ ãŒè¨­è¨ˆã®çœŸå®Ÿ
#
# Usage:
#   cd /path/to/oflike_metal_skeleton
#   ralph run -c ralph.yml -p "docs/INDEX.md"

event_loop:
  prompt_file: "docs/INDEX.md"
  completion_promise: "LOOP_COMPLETE"
  max_iterations: 1000
  max_runtime_seconds: 28800  # 8 hours
  checkpoint_interval: 5
  starting_event: "build.task"

cli:
  backend: "claude"

core:
  specs_dir: "./docs/"
  guardrails:
    # === ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé§†å‹• ===
    - "docs/INDEX.md ã‚’æœ€åˆã«èª­ã‚€ - å…¨ä½“æ§‹é€ ã‚’æŠŠæ¡"
    - "docs/ARCHITECTURE.md ã®ç¦æ­¢äº‹é …ã¯çµ¶å¯¾ - ä¾‹å¤–ãªã—"
    - "docs/IMPLEMENTATION.md ã§é€²æ—ç¢ºèª - æ¬¡ã®Phaseã‚’ç‰¹å®š"
    - "docs/api/*.md ã«è¨­è¨ˆãŒã‚ã‚‹ - å®Ÿè£…å‰ã«å¿…ãšç¢ºèª"
    - "docs/metal/*.md ã§Metalè©³ç´°ã‚’ç¢ºèª"
    # === çµ¶å¯¾ç¦æ­¢ (ARCHITECTURE.md ã‚ˆã‚Š) ===
    - "âŒ FreeTypeç¦æ­¢ â†’ Core Textä½¿ç”¨"
    - "âŒ stb_imageç¦æ­¢ â†’ ImageIO/MTKTextureLoaderä½¿ç”¨"
    - "âŒ OpenGLç¦æ­¢ â†’ Metalä½¿ç”¨"
    - "âŒ SDL/GLFWç¦æ­¢ â†’ Cocoa/AppKitä½¿ç”¨"
    - "âŒ å¤–éƒ¨SIMDãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¦æ­¢ â†’ Accelerateä½¿ç”¨"
    # === å¿…é ˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ ===
    - "âœ… Metal / MetalKit - GPUæç”»"
    - "âœ… Core Text - ãƒ•ã‚©ãƒ³ãƒˆ"
    - "âœ… ImageIO / MTKTextureLoader - ç”»åƒèª­ã¿è¾¼ã¿"
    - "âœ… Core Graphics - ãƒ‘ã‚¹ã€ãƒ“ãƒƒãƒˆãƒãƒƒãƒ—"
    - "âœ… Cocoa - ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã€ã‚¤ãƒ™ãƒ³ãƒˆ"
    # === openFrameworksäº’æ› ===
    - "oF APIã‚·ã‚°ãƒãƒãƒ£ã‚’ç¶­æŒ - å†…éƒ¨ã¯Metalæœ€é©åŒ–"
    - "GLå®šæ•°ã¯å†…éƒ¨ã§Metalã«å¤‰æ›"

hats:
  builder:
    name: "ğŸ”¨ Builder"
    description: "oFã‚½ãƒ¼ã‚¹ã‚’èª­ã¿ã€ARCHITECTURE.mdã«å¾“ã£ã¦Metalç‰ˆã‚’å®Ÿè£…ã€‚"
    triggers: ["build.task"]
    publishes: ["build.done", "build.blocked"]
    default_publishes: "build.done"
    instructions: |
      ## BUILDER PHASE

      oFã‚½ãƒ¼ã‚¹ã‚’èª­ã¿ â†’ ARCHITECTURE.mdã«å¾“ã„ â†’ Metalç‰ˆã‚’å®Ÿè£…

      ### âš ï¸ ç§»æ¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (æ¯å›å¿…ãšå®Ÿè¡Œ)

      **Step 1: IMPLEMENTATION.md ã§æ¬¡ã®ã‚¿ã‚¹ã‚¯ã‚’ç¢ºèª**
      ```bash
      cat docs/IMPLEMENTATION.md | head -100
      ```
      â†’ æ¬¡ã® â¬œ æœªå®Ÿè£… ã‚’ç‰¹å®š

      **Step 2: oFã‚ªãƒªã‚¸ãƒŠãƒ«ã‚½ãƒ¼ã‚¹ã‚’èª­ã‚€ (æœ€é‡è¦)**
      ```bash
      # IMPLEMENTATION.md ã§ç‰¹å®šã—ãŸ â¬œ ãƒ•ã‚¡ã‚¤ãƒ«ã®oFã‚½ãƒ¼ã‚¹ã‚’èª­ã‚€
      # ãƒ‘ã‚¿ãƒ¼ãƒ³: references/of_v0.12.1_osx_release/libs/openFrameworks/<category>/<file>
      #
      # ä¾‹:
      #   3d/of3dUtils.h â†’ cat references/.../3d/of3dUtils.h
      #   math/ofMath.h â†’ cat references/.../math/ofMath.h
      #   utils/ofUtils.h â†’ cat references/.../utils/ofUtils.h
      #   app/ofBaseApp.h â†’ cat references/.../app/ofBaseApp.h
      #
      cat references/of_v0.12.1_osx_release/libs/openFrameworks/<category>/<file>.h
      cat references/of_v0.12.1_osx_release/libs/openFrameworks/<category>/<file>.cpp
      ```
      â†’ APIã‚·ã‚°ãƒãƒãƒ£ã€å®Ÿè£…ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç†è§£
      â†’ IMPLEMENTATION.md ã®ã€Œç§»æ¤å…ˆã€ã‚«ãƒ©ãƒ ã‚’è¦‹ã¦ã€ã©ã“ã«å®Ÿè£…ã™ã‚‹ã‹ç¢ºèª

      **Step 3: ARCHITECTURE.md ã§ç¦æ­¢äº‹é …ã‚’ç¢ºèª**
      ```bash
      cat docs/ARCHITECTURE.md
      ```
      â†’ oFã‚½ãƒ¼ã‚¹ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ç¦æ­¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç‰¹å®šã—ã€ä»£æ›¿ã‚’æ±ºå®š:
      | oFã§ä½¿ç”¨ | Metalç‰ˆã§ä½¿ç”¨ |
      |----------|---------------|
      | OpenGL (gl*, GL_*) | Metal |
      | FreeType | Core Text |
      | stb_image | ImageIO / MTKTextureLoader |
      | GLFW/SDL | Cocoa / AppKit |

      **Step 4: docs/api/*.md ã‚’ç¢ºèª/ä½œæˆ**
      ```bash
      # IMPLEMENTATION.md ã®ã€ŒAPIè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
      # è©²å½“ã‚«ãƒ†ã‚´ãƒªã®è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒ â¬œ ãªã‚‰å…ˆã«ä½œæˆ
      #
      # ä¾‹: math/ ã‚’ç§»æ¤ã™ã‚‹å ´åˆ
      #   â†’ docs/api/MATH.md ãŒã‚ã‚‹ã‹ç¢ºèª
      #   â†’ ãªã‘ã‚Œã°ä½œæˆã—ã¦ã‹ã‚‰å®Ÿè£…
      #
      # æ—¢å­˜: CORE.md, GRAPHICS_2D.md, GRAPHICS_3D.md, IMAGE.md,
      #       LIGHTING.md, MESH.md, TYPOGRAPHY.md, COLOR.md, MATH.md
      # æœªä½œæˆ: APP.md, EVENTS.md, UTILS.md, FBO.md, SOUND.md, VIDEO.md,
      #         COMMUNICATION.md, TYPES.md
      cat docs/api/<NAME>.md  # æ—¢å­˜ãªã‚‰èª­ã‚€
      ```

      **Step 5: å®Ÿè£…**
      - oFã®APIã‚·ã‚°ãƒãƒãƒ£ã‚’ç¶­æŒ
      - å†…éƒ¨å®Ÿè£…ã¯Metal/macOSãƒã‚¤ãƒ†ã‚£ãƒ–ã«ç½®ãæ›ãˆ
      - ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ç´”ç²‹C++ (.h)
      - Objective-Cå¿…è¦ãªã‚‰å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã¯ .mm

      **Step 6: IMPLEMENTATION.md ã‚’æ›´æ–°**
      - â¬œ â†’ âœ… ã«å¤‰æ›´

      ### oFã‚½ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
      ```
      references/of_v0.12.1_osx_release/libs/openFrameworks/
      â”œâ”€â”€ 3d/           # ofNode, ofCamera, ofMesh, of3dPrimitives
      â”œâ”€â”€ app/          # ofBaseApp, ofAppRunner
      â”œâ”€â”€ communication/# ofSerial, ofArduino
      â”œâ”€â”€ events/       # ofEvent, ofEvents
      â”œâ”€â”€ gl/           # ofTexture, ofFbo, ofShader, ofLight
      â”œâ”€â”€ graphics/     # ofGraphics, ofPath, ofTrueTypeFont, ofImage
      â”œâ”€â”€ math/         # ofVec*, ofMatrix*, ofMath
      â”œâ”€â”€ sound/        # ofSoundPlayer, ofSoundStream
      â”œâ”€â”€ types/        # ofColor, ofRectangle, ofParameter
      â”œâ”€â”€ utils/        # ofUtils, ofFileUtils, ofLog
      â””â”€â”€ video/        # ofVideoPlayer, ofVideoGrabber
      ```

      ### Before Starting
      1. `ralph tools task list` ã§ open tasks ç¢ºèª
      2. ãªã‘ã‚Œã° IMPLEMENTATION.md ã‚’èª­ã‚“ã§æœ€åˆã® â¬œ ã‚’è¦‹ã¤ã‘ã‚‹
      3. `ralph tools task add "Port: <category>/<file>.h" -p 1`
         - category: 3d, app, math, utils, graphics, gl, events, etc.
         - file: IMPLEMENTATION.md ã®ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚«ãƒ©ãƒ ã®å€¤

      ### Backpressure
      ```bash
      cd build && cmake .. && make -j8 2>&1 | head -100
      ```

      ### å®Œäº†æ™‚
      1. docs/IMPLEMENTATION.md ã‚’æ›´æ–°:
         - è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ â¬œ â†’ âœ…
         - APIè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ãŸå ´åˆã€ãã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚‚ âœ…
      2. `ralph tools task close <id>`
      3. `ralph emit "build.done" "ported: <APIå> from oF, updated: IMPLEMENTATION.md"`

      ### ãƒ–ãƒ­ãƒƒã‚¯æ™‚
      ```bash
      ralph emit "build.blocked" "tried: <what>, blocked: <why>"
      ```

  confessor:
    name: "ğŸ” Confessor"
    description: "oFäº’æ›æ€§ã€ARCHITECTURE.mdæº–æ‹ ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§ã‚’ç›£æŸ»ã€‚"
    triggers: ["build.done"]
    publishes: ["confession.clean", "confession.issues_found"]
    instructions: |
      ## CONFESSION PHASE

      ç§»æ¤ã®å“è³ªã‚’ç›£æŸ»ã™ã‚‹ã€‚

      ### âš ï¸ ãƒã‚§ãƒƒã‚¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (æ¯å›å®Ÿè¡Œ)

      **Step 1: oFã‚ªãƒªã‚¸ãƒŠãƒ«ã¨æ¯”è¼ƒ**
      ```bash
      # ç§»æ¤ã•ã‚ŒãŸAPIã®oFã‚ªãƒªã‚¸ãƒŠãƒ«ã‚’èª­ã‚€
      cat references/of_v0.12.1_osx_release/libs/openFrameworks/<category>/<file>.h
      ```
      â†’ APIã‚·ã‚°ãƒãƒãƒ£ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèª

      **Step 2: ARCHITECTURE.md é•åãƒã‚§ãƒƒã‚¯**
      ```bash
      cat docs/ARCHITECTURE.md
      ```

      **ç¦æ­¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæ··å…¥ã—ã¦ã„ãªã„ã‹ grep:**
      ```bash
      grep -r "FreeType\|freetype" src/
      grep -r "stb_image\|STB_IMAGE" src/
      grep -r "glBegin\|glEnd\|GL_\|glGen\|glBind" src/
      grep -r "SDL_\|GLFW" src/
      ```
      â†’ ãƒ’ãƒƒãƒˆã—ãŸã‚‰å³ `confession.issues_found`

      **Step 3: IMPLEMENTATION.md æ›´æ–°ç¢ºèª**
      ```bash
      cat docs/IMPLEMENTATION.md
      ```
      â†’ ç§»æ¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒ â¬œ â†’ âœ… ã«ãªã£ã¦ã„ã‚‹ã‹

      ### oFäº’æ›æ€§ãƒã‚§ãƒƒã‚¯
      1. **APIã‚·ã‚°ãƒãƒãƒ£ä¸€è‡´?**
         - é–¢æ•°åã€å¼•æ•°ã€æˆ»ã‚Šå€¤ãŒoFã¨åŒã˜ã‹
         - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã‚‚ä¸€è‡´ã‹
      2. **æŒ¯ã‚‹èˆã„äº’æ›?**
         - åº§æ¨™ç³» (å·¦ä¸ŠåŸç‚¹, +xå³, +yä¸‹)
         - å˜ä½ (points vs pixels)
      3. **ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ˜ãƒƒãƒ€ãƒ¼ç´”ç²‹C++?**
         - .h ã«Objective-Cå‹ (id, NS*, @) ãŒãªã„ã‹

      ### ConfessionReport
      ```bash
      ralph tools memory add "confession: oF-compat=<APIå>, match=Yes|No, diff=<è©³ç´°>" -t context --tags confession
      ralph tools memory add "confession: arch-violation=None|<è©³ç´°>" -t context --tags confession
      ralph tools memory add "confession: impl-md-updated=Yes|No" -t context --tags confession
      ```

      ### Publish
      - ARCHITECTUREé•å â†’ å³ `confession.issues_found`
      - oF APIä¸ä¸€è‡´ â†’ `confession.issues_found`
      - IMPLEMENTATION.md æœªæ›´æ–° â†’ `confession.issues_found`
      - å•é¡Œãªã— AND confidence >= 80 â†’ `confession.clean`

  handler:
    name: "âš–ï¸ Handler"
    description: "æ¬¡ã®Phase/ã‚¿ã‚¹ã‚¯ã‚’æ±ºå®šã€‚IMPLEMENTATION.mdã‚’å‚ç…§ã€‚"
    triggers: ["confession.issues_found", "confession.clean"]
    publishes: ["build.task", "escalate.human"]
    instructions: |
      ## HANDLER PHASE

      ### âš ï¸ æœ€åˆã«å¿…ãš IMPLEMENTATION.md ã‚’èª­ã‚€ (æ¯å›å®Ÿè¡Œ)
      ```bash
      cat docs/IMPLEMENTATION.md
      ```
      â†’ ç¾åœ¨ã®Phaseå®Œäº†çŠ¶æ³ã¨æ¬¡ã® â¬œ ã‚’ç‰¹å®š

      ### confession.issues_found ã®å ´åˆ
      1. å•é¡Œã‚’æ¤œè¨¼
      2. å•é¡ŒãŒå®Ÿåœ¨:
         - è»½å¾®: `ralph tools task add "Fix: <issue>" -p 1` â†’ `build.task`
         - é‡å¤§ (ARCHITECTUREé•å): `escalate.human`
      3. èª¤æ¤œçŸ¥: `escalate.human`

      ### confession.clean ã®å ´åˆ

      **IMPLEMENTATION.md ã® â¬œ ã‚’è¦‹ã¦æ¬¡ã®ã‚¿ã‚¹ã‚¯ã‚’æ±ºå®š:**

      å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º (IMPLEMENTATION.mdã‚ˆã‚Š):
      - Phase 1-5: âœ… å®Œäº†
      - Phase 6: Mathæ‹¡å¼µ (ofMatrix, ofQuaternion, ofMath)
      - Phase 7: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (ofUtils, ofFileUtils, ofLog)
      - Phase 8: ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ  (ofEvent, ofEvents)
      - Phase 9: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŸºç›¤ (ofBaseApp, ofAppRunner)
      - Phase 10: FBOãƒ»ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ (ofFbo, ofShader, ofVbo)
      - Phase 11: é«˜åº¦ãªã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ (ofImage, ofTessellator)
      - Phase 12: ã‚µã‚¦ãƒ³ãƒ‰ (ofSoundPlayer, ofSoundStream)
      - Phase 13: ãƒ“ãƒ‡ã‚ª (ofVideoPlayer, ofVideoGrabber)
      - Phase 14: é€šä¿¡ (ofSerial, ofArduino)
      - Phase 15: æ‹¡å¼µå‹ (ofParameter)

      ### æ¬¡ã®ã‚¿ã‚¹ã‚¯ä½œæˆ
      ```bash
      # IMPLEMENTATION.md ã‚’èª­ã‚“ã§ã€æœ€åˆã«è¦‹ã¤ã‹ã£ãŸ â¬œ ã‚’ã‚¿ã‚¹ã‚¯ã«ã™ã‚‹
      # ä¾‹:
      #   â¬œ math/ofMath.h â†’ ralph tools task add "Port: math/ofMath.h" -p 1
      #   â¬œ utils/ofUtils.h â†’ ralph tools task add "Port: utils/ofUtils.h" -p 1
      #   â¬œ app/ofBaseApp.h â†’ ralph tools task add "Port: app/ofBaseApp.h" -p 1
      #
      # ã‚¿ã‚¹ã‚¯åã«oFã‚½ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’å«ã‚ã‚‹:
      ralph tools task add "Port: <category>/<file>.h from references/of_v0.12.1_osx_release/libs/openFrameworks/" -p 1
      ralph emit "build.task" "next: <file> from oF <category>/"
      ```

      **é‡è¦:** IMPLEMENTATION.md ã®ä¸Šã‹ã‚‰é †ã« â¬œ ã‚’æ¢ã—ã€æœ€åˆã«è¦‹ã¤ã‹ã£ãŸã‚‚ã®ã‚’é¸ã¶ã€‚
      ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªã«å›ºåŸ·ã—ãªã„ã€‚

      ### é€²æ—è¨˜éŒ²
      ```bash
      ralph tools memory add "ported: <APIå>, next: <æ¬¡ã®API>" -t pattern --tags progress
      ```

      ### LOOP_COMPLETE æ¡ä»¶
      - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ "stop" ã¾ãŸã¯ "done" ã¨è¨€ã£ãŸå ´åˆ
      - å…¨Phaseå®Œäº†ã—ãŸå ´åˆ (IMPLEMENTATION.mdã§ â¬œ ãŒãªããªã£ãŸå ´åˆ)

# Task tracking
tasks:
  enabled: true

# Memory - ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã§å­¦ç¿’ã‚’ä¿æŒ
memories:
  enabled: true
  inject: auto
  budget: 3000
  filter:
    types: []
    tags: []
    recent: 0
